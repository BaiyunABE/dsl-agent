{
  "type": "Script",
  "lineno": 1,
  "children": [
    {
      "type": "ConfigSection",
      "lineno": 2,
      "children": [
        {
          "type": "ConfigItem",
          "value": "default_intent",
          "lineno": 3,
          "children": [
            {
              "type": "String",
              "value": "greeting",
              "lineno": 3
            }
          ]
        },
        {
          "type": "ConfigItem",
          "value": "timeout",
          "lineno": 4,
          "children": [
            {
              "type": "Number",
              "value": 30,
              "lineno": 4
            }
          ]
        },
        {
          "type": "ConfigItem",
          "value": "max_retries",
          "lineno": 5,
          "children": [
            {
              "type": "Number",
              "value": 3,
              "lineno": 5
            }
          ]
        }
      ]
    },
    {
      "type": "VarSection",
      "lineno": 7,
      "children": [
        {
          "type": "VarDeclaration",
          "value": "login_count",
          "lineno": 8,
          "children": [
            {
              "type": "Number",
              "value": 0,
              "lineno": 8
            }
          ]
        },
        {
          "type": "VarDeclaration",
          "value": "last_order",
          "lineno": 9,
          "children": [
            {
              "type": "String",
              "value": "",
              "lineno": 9
            }
          ]
        },
        {
          "type": "VarDeclaration",
          "value": "global_status",
          "lineno": 10,
          "children": [
            {
              "type": "String",
              "value": "",
              "lineno": 10
            }
          ]
        }
      ]
    },
    {
      "type": "FunctionSection",
      "lineno": 12,
      "children": [
        {
          "type": "FunctionMapping",
          "value": "calc_delivery",
          "lineno": 13,
          "children": [
            {
              "type": "String",
              "value": "order_utils.calculate_delivery"
            }
          ]
        },
        {
          "type": "FunctionMapping",
          "value": "validate_order",
          "lineno": 14,
          "children": [
            {
              "type": "String",
              "value": "order_utils.validate_order_id"
            }
          ]
        }
      ]
    },
    {
      "type": "Intent",
      "value": "greeting",
      "lineno": 16,
      "children": [
        {
          "type": "Reply",
          "value": "您好！欢迎光临！",
          "lineno": 17
        },
        {
          "type": "Reply",
          "value": "请问有什么可以帮您？",
          "lineno": 18
        },
        {
          "type": "Set",
          "value": "login_count",
          "lineno": 19,
          "children": [
            {
              "type": "Arithmetic",
              "value": "+",
              "lineno": 19,
              "children": [
                {
                  "type": "Variable",
                  "value": "$login_count",
                  "lineno": 19
                },
                {
                  "type": "Number",
                  "value": 1,
                  "lineno": 19
                }
              ]
            }
          ]
        },
        {
          "type": "Set",
          "value": "global_status",
          "lineno": 20,
          "children": [
            {
              "type": "String",
              "value": "",
              "lineno": 20
            }
          ]
        },
        {
          "type": "Log",
          "value": "用户问候，登录次数：$login_count，状态：$global_status",
          "lineno": 21
        }
      ]
    },
    {
      "type": "Intent",
      "value": "check_order",
      "lineno": 23,
      "children": [
        {
          "type": "Reply",
          "value": "正在查询订单信息...",
          "lineno": 24
        },
        {
          "type": "Set",
          "value": "global_status",
          "lineno": 25,
          "children": [
            {
              "type": "String",
              "value": "check_order",
              "lineno": 25
            }
          ]
        },
        {
          "type": "Reply",
          "value": "请问您要查询哪个订单号？",
          "lineno": 26
        },
        {
          "type": "Log",
          "value": "订单查询请求，状态：$global_status",
          "lineno": 27
        }
      ]
    },
    {
      "type": "Intent",
      "value": "provide_order_number",
      "lineno": 29,
      "children": [
        {
          "type": "IfStatement",
          "lineno": 30,
          "children": [
            {
              "type": "Matches",
              "value": "matches",
              "lineno": 30,
              "children": [
                {
                  "type": "Variable",
                  "value": "$user_input",
                  "lineno": 30
                },
                "ORDER\\\\d+"
              ]
            },
            {
              "type": "ThenBranch",
              "lineno": 30,
              "children": [
                {
                  "type": "Set",
                  "value": "last_order",
                  "lineno": 31,
                  "children": [
                    {
                      "type": "Variable",
                      "value": "$user_input",
                      "lineno": 31
                    }
                  ]
                },
                {
                  "type": "Call",
                  "lineno": 32,
                  "children": [
                    {
                      "type": "Assignment",
                      "value": "is_valid",
                      "lineno": 32,
                      "children": [
                        {
                          "type": "FunctionCall",
                          "value": "validate_order",
                          "lineno": 32,
                          "children": [
                            "$user_input"
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "IfStatement",
                  "lineno": 34,
                  "children": [
                    {
                      "type": "Variable",
                      "value": "$is_valid",
                      "lineno": 34
                    },
                    {
                      "type": "ThenBranch",
                      "lineno": 34,
                      "children": [
                        {
                          "type": "Reply",
                          "value": "订单 $user_input 验证成功！",
                          "lineno": 35
                        },
                        {
                          "type": "Reply",
                          "value": "订单状态：已发货",
                          "lineno": 36
                        },
                        {
                          "type": "Call",
                          "lineno": 37,
                          "children": [
                            {
                              "type": "Assignment",
                              "value": "delivery_date",
                              "lineno": 37,
                              "children": [
                                {
                                  "type": "FunctionCall",
                                  "value": "calc_delivery",
                                  "lineno": 37,
                                  "children": [
                                    "$user_input"
                                  ]
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "type": "Reply",
                          "value": "预计送达时间：$delivery_date",
                          "lineno": 38
                        },
                        {
                          "type": "IfStatement",
                          "lineno": 40,
                          "children": [
                            {
                              "type": "Comparison",
                              "value": "==",
                              "lineno": 40,
                              "children": [
                                {
                                  "type": "Variable",
                                  "value": "$global_status",
                                  "lineno": 40
                                },
                                {
                                  "type": "String",
                                  "value": "check_order",
                                  "lineno": 40
                                }
                              ]
                            },
                            {
                              "type": "ThenBranch",
                              "lineno": 40,
                              "children": [
                                {
                                  "type": "Reply",
                                  "value": "订单查询完成，请问还需要其他帮助吗？",
                                  "lineno": 41
                                }
                              ]
                            },
                            {
                              "type": "ElseBranch",
                              "lineno": 40,
                              "children": [
                                {
                                  "type": "IfStatement",
                                  "lineno": 43,
                                  "children": [
                                    {
                                      "type": "Comparison",
                                      "value": "==",
                                      "lineno": 43,
                                      "children": [
                                        {
                                          "type": "Variable",
                                          "value": "$global_status",
                                          "lineno": 43
                                        },
                                        {
                                          "type": "String",
                                          "value": "return_request",
                                          "lineno": 43
                                        }
                                      ]
                                    },
                                    {
                                      "type": "Reply",
                                      "value": "订单信息已确认，是否为此订单申请退货？",
                                      "lineno": 44
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "type": "ElseBranch",
                      "lineno": 34,
                      "children": [
                        {
                          "type": "Reply",
                          "value": "订单号 $user_input 无效或不存在",
                          "lineno": 48
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "ElseBranch",
              "lineno": 30,
              "children": [
                {
                  "type": "Reply",
                  "value": "订单号格式不正确，请提供类似 ORDER123 的格式",
                  "lineno": 51
                }
              ]
            }
          ]
        },
        {
          "type": "Log",
          "value": "订单号处理：$user_input，当前状态：$global_status",
          "lineno": 53
        }
      ]
    },
    {
      "type": "Intent",
      "value": "return_request",
      "lineno": 55,
      "children": [
        {
          "type": "Reply",
          "value": "了解您要退货的需求",
          "lineno": 56
        },
        {
          "type": "Set",
          "value": "global_status",
          "lineno": 57,
          "children": [
            {
              "type": "String",
              "value": "return_request",
              "lineno": 57
            }
          ]
        },
        {
          "type": "Reply",
          "value": "请提供需要退货的订单号",
          "lineno": 58
        },
        {
          "type": "Log",
          "value": "退货申请开始，状态：$global_status",
          "lineno": 59
        }
      ]
    },
    {
      "type": "Intent",
      "value": "confirm_return",
      "lineno": 61,
      "children": [
        {
          "type": "Reply",
          "value": "已为您提交订单 $last_order 的退货申请",
          "lineno": 62
        },
        {
          "type": "Reply",
          "value": "客服将在24小时内联系您处理后续事宜",
          "lineno": 63
        },
        {
          "type": "Reply",
          "value": "退货编号：RET123456",
          "lineno": 64
        },
        {
          "type": "Set",
          "value": "global_status",
          "lineno": 65,
          "children": [
            {
              "type": "String",
              "value": "",
              "lineno": 65
            }
          ]
        },
        {
          "type": "Log",
          "value": "退货确认完成，状态重置：$global_status",
          "lineno": 66
        }
      ]
    },
    {
      "type": "Intent",
      "value": "complaint",
      "lineno": 68,
      "children": [
        {
          "type": "Reply",
          "value": "抱歉给您带来不便",
          "lineno": 69
        },
        {
          "type": "Reply",
          "value": "请简要描述您遇到的问题：",
          "lineno": 70
        },
        {
          "type": "Set",
          "value": "global_status",
          "lineno": 71,
          "children": [
            {
              "type": "String",
              "value": "complaint",
              "lineno": 71
            }
          ]
        },
        {
          "type": "Log",
          "value": "用户投诉受理，状态：$global_status",
          "lineno": 72
        }
      ]
    },
    {
      "type": "Intent",
      "value": "describe_issue",
      "lineno": 74,
      "children": [
        {
          "type": "Reply",
          "value": "感谢您的反馈，我们已经记录：$user_input",
          "lineno": 75
        },
        {
          "type": "Reply",
          "value": "客服专员将尽快联系您处理",
          "lineno": 76
        },
        {
          "type": "Reply",
          "value": "紧急问题可拨打热线：400-123-4567",
          "lineno": 77
        },
        {
          "type": "Set",
          "value": "global_status",
          "lineno": 78,
          "children": [
            {
              "type": "String",
              "value": "",
              "lineno": 78
            }
          ]
        },
        {
          "type": "Log",
          "value": "问题描述记录，状态：$global_status",
          "lineno": 79
        }
      ]
    },
    {
      "type": "Intent",
      "value": "ask_human_agent",
      "lineno": 81,
      "children": [
        {
          "type": "Reply",
          "value": "正在为您转接人工客服...",
          "lineno": 82
        },
        {
          "type": "Log",
          "value": "请求人工客服，状态：$global_status",
          "lineno": 83
        }
      ]
    },
    {
      "type": "Intent",
      "value": "unknown",
      "lineno": 85,
      "children": [
        {
          "type": "IfStatement",
          "lineno": 86,
          "children": [
            {
              "type": "Comparison",
              "value": "==",
              "lineno": 86,
              "children": [
                {
                  "type": "Variable",
                  "value": "$global_status",
                  "lineno": 86
                },
                {
                  "type": "String",
                  "value": "check_order",
                  "lineno": 86
                }
              ]
            },
            {
              "type": "ThenBranch",
              "lineno": 86,
              "children": [
                {
                  "type": "Reply",
                  "value": "抱歉，我没有理解您关于订单查询的请求",
                  "lineno": 87
                },
                {
                  "type": "Reply",
                  "value": "请提供订单号（格式：ORDER123）或说明您的需求",
                  "lineno": 88
                }
              ]
            },
            {
              "type": "ElseBranch",
              "lineno": 86,
              "children": [
                {
                  "type": "IfStatement",
                  "lineno": 90,
                  "children": [
                    {
                      "type": "Comparison",
                      "value": "==",
                      "lineno": 90,
                      "children": [
                        {
                          "type": "Variable",
                          "value": "$global_status",
                          "lineno": 90
                        },
                        {
                          "type": "String",
                          "value": "return_request",
                          "lineno": 90
                        }
                      ]
                    },
                    {
                      "type": "ThenBranch",
                      "lineno": 90,
                      "children": [
                        {
                          "type": "Reply",
                          "value": "抱歉，我没有理解您关于退货的请求",
                          "lineno": 91
                        },
                        {
                          "type": "Reply",
                          "value": "请提供订单号或确认是否申请退货",
                          "lineno": 92
                        }
                      ]
                    },
                    {
                      "type": "ElseBranch",
                      "lineno": 90,
                      "children": [
                        {
                          "type": "Reply",
                          "value": "抱歉，我没有完全理解您的意思",
                          "lineno": 94
                        },
                        {
                          "type": "Reply",
                          "value": "您可以尝试以下方式：",
                          "lineno": 95
                        },
                        {
                          "type": "Reply",
                          "value": "1. 查询订单状态",
                          "lineno": 96
                        },
                        {
                          "type": "Reply",
                          "value": "2. 申请退货",
                          "lineno": 97
                        },
                        {
                          "type": "Reply",
                          "value": "3. 联系人工客服",
                          "lineno": 98
                        },
                        {
                          "type": "Reply",
                          "value": "请问您需要哪项服务？",
                          "lineno": 99
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "Log",
          "value": "未知意图处理：$user_input，当前状态：$global_status",
          "lineno": 102
        }
      ]
    },
    {
      "type": "Intent",
      "value": "thankyou",
      "lineno": 104,
      "children": [
        {
          "type": "Reply",
          "value": "不客气！",
          "lineno": 105
        },
        {
          "type": "Reply",
          "value": "祝您生活愉快！",
          "lineno": 106
        },
        {
          "type": "Set",
          "value": "global_status",
          "lineno": 107,
          "children": [
            {
              "type": "String",
              "value": "",
              "lineno": 107
            }
          ]
        },
        {
          "type": "Log",
          "value": "用户致谢，状态重置：$global_status",
          "lineno": 108
        }
      ]
    },
    {
      "type": "Intent",
      "value": "reset",
      "lineno": 110,
      "children": [
        {
          "type": "Reply",
          "value": "系统已重置",
          "lineno": 111
        },
        {
          "type": "Set",
          "value": "login_count",
          "lineno": 112,
          "children": [
            {
              "type": "Number",
              "value": 0,
              "lineno": 112
            }
          ]
        },
        {
          "type": "Set",
          "value": "last_order",
          "lineno": 113,
          "children": [
            {
              "type": "String",
              "value": "",
              "lineno": 113
            }
          ]
        },
        {
          "type": "Set",
          "value": "global_status",
          "lineno": 114,
          "children": [
            {
              "type": "String",
              "value": "",
              "lineno": 114
            }
          ]
        },
        {
          "type": "Log",
          "value": "系统重置操作，状态：$global_status",
          "lineno": 115
        }
      ]
    },
    {
      "type": "Intent",
      "value": "help",
      "lineno": 117,
      "children": [
        {
          "type": "IfStatement",
          "lineno": 118,
          "children": [
            {
              "type": "Comparison",
              "value": "==",
              "lineno": 118,
              "children": [
                {
                  "type": "Variable",
                  "value": "$global_status",
                  "lineno": 118
                },
                {
                  "type": "String",
                  "value": "check_order",
                  "lineno": 118
                }
              ]
            },
            {
              "type": "ThenBranch",
              "lineno": 118,
              "children": [
                {
                  "type": "Reply",
                  "value": "=== 订单查询帮助 ===",
                  "lineno": 119
                },
                {
                  "type": "Reply",
                  "value": "请提供订单号（格式：ORDER123）",
                  "lineno": 120
                },
                {
                  "type": "Reply",
                  "value": "或输入'返回'回到主菜单",
                  "lineno": 121
                }
              ]
            },
            {
              "type": "ElseBranch",
              "lineno": 118,
              "children": [
                {
                  "type": "IfStatement",
                  "lineno": 123,
                  "children": [
                    {
                      "type": "Comparison",
                      "value": "==",
                      "lineno": 123,
                      "children": [
                        {
                          "type": "Variable",
                          "value": "$global_status",
                          "lineno": 123
                        },
                        {
                          "type": "String",
                          "value": "return_request",
                          "lineno": 123
                        }
                      ]
                    },
                    {
                      "type": "ThenBranch",
                      "lineno": 123,
                      "children": [
                        {
                          "type": "Reply",
                          "value": "=== 退货申请帮助 ===",
                          "lineno": 124
                        },
                        {
                          "type": "Reply",
                          "value": "请提供订单号或确认退货申请",
                          "lineno": 125
                        },
                        {
                          "type": "Reply",
                          "value": "或输入'返回'取消退货流程",
                          "lineno": 126
                        }
                      ]
                    },
                    {
                      "type": "ElseBranch",
                      "lineno": 123,
                      "children": [
                        {
                          "type": "Reply",
                          "value": "=== 可用功能 ===",
                          "lineno": 128
                        },
                        {
                          "type": "Reply",
                          "value": "订单管理 - 查询订单、退货申请",
                          "lineno": 129
                        },
                        {
                          "type": "Reply",
                          "value": "人工客服 - 转接人工服务",
                          "lineno": 130
                        },
                        {
                          "type": "Reply",
                          "value": "系统重置 - 清除当前会话数据",
                          "lineno": 131
                        },
                        {
                          "type": "Reply",
                          "value": "帮助信息 - 显示本提示",
                          "lineno": 132
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "Log",
          "value": "用户请求帮助，当前状态：$global_status",
          "lineno": 135
        }
      ]
    }
  ]
}